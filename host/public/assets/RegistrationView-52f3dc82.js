import{u as w,r as i,m as c,c as g,g as f}from"./index-c6def6da-6b083fe0.js";import{_ as E,L as V,u as v,au as y,H as S,I as n,r as b,o as d,b as U,d as r,w as t,k as _,l as k,g as R,P as A,i as N,J as q,Q as l,h as B,j as u,v as C,p as I,m as L,e as m}from"./main-3e49f720.js";const $={name:"registration-view",setup:()=>({v$:w(),userStore:V(),loadingStore:v()}),data:()=>({name:"",email:"",password:"",emailErrors:"",nameErrors:"",passwordErrors:"",emailError:null,passwordError:null}),validations(){return{name:{required:i},email:{required:i,emailNotExists:function(){return!this.emailExists}},password:{required:i,minLength:c(6),containsUppercase:function(e){return/[A-Z]/.test(e)},containsLowercase:function(e){return/[a-z]/.test(e)},containsNumber:function(e){return/[0-9]/.test(e)}}}},watch:{email(){this.emailError=null},password(){this.passwordError=null}},computed:{alert(){return this.emailError||this.passwordError||null}},methods:{async createEmptyUser(e,s){await y(S(q,"users",e),{name:s,status:"user",favorite:[],saved:[],regDate:new Date}),await n("addEmptyUserToDb")},async handleRegResponse(e){const s=e.user.uid;await this.createEmptyUser(s,this.name),this.userStore.updateUid(s),await this.userStore.loadUser(),await this.$router.push("/")},handleRegError(e){switch(e.code){case"auth/invalid-email":this.emailError="Неправильный формат почты";break;case"auth/email-already-in-use":this.emailError="Почта уже использована";break}},async register(){await this.v$.$validate()&&(this.loadingStore.start(),await g(f(),this.email,this.password).then(this.handleRegResponse).catch(this.handleRegError).finally(()=>{n("register"),this.loadingStore.end()}))}}},p=e=>(I("data-v-9f267621"),e=e(),L(),e),D={class:"registration"},F=p(()=>m("h2",null,"Регистрация",-1)),M=p(()=>m("h5",null,"Есть аккаунт? Войти.",-1));function T(e,s,z,P,Z,o){const h=b("router-link");return d(),U("div",D,[F,r(k,{onSubmit:_(o.register,["prevent"])},{default:t(()=>[r(l,{modelValue:e.name,"onUpdate:modelValue":s[0]||(s[0]=a=>e.name=a),modelModifiers:{trim:!0},"error-messages":e.nameErrors,rules:[()=>!!e.name||"Имя отсутствует."],label:"Имя",required:""},null,8,["modelValue","error-messages","rules"]),r(l,{modelValue:e.email,"onUpdate:modelValue":s[1]||(s[1]=a=>e.email=a),modelModifiers:{trim:!0},"error-messages":e.emailErrors,rules:[()=>!!e.email||"Почта отсутствует."],label:"E-mail",required:""},null,8,["modelValue","error-messages","rules"]),r(l,{modelValue:e.password,"onUpdate:modelValue":s[2]||(s[2]=a=>e.password=a),modelModifiers:{trim:!0},counter:e.password.length<6?6:!1,"error-messages":e.passwordErrors,rules:[()=>!!e.password||"Пароль отсутствует.",()=>e.password.length>=6||"Пароль меньше 6 символов.",()=>/[A-Z]/.test(e.password)||"Пароль должен содержать заглавные буквы",()=>/[a-z]/.test(e.password)||"Пароль должен содержать прописные буквы",()=>/[0-9]/.test(e.password)||"Пароль должен содержать цифры"],label:"Пароль",required:"",type:"password"},null,8,["modelValue","counter","error-messages","rules"]),r(B,{class:"btnSubmit",type:"submit"},{default:t(()=>[u("Зарегистрироваться")]),_:1}),r(h,{class:"swap",to:"/login"},{default:t(()=>[M]),_:1})]),_:1},8,["onSubmit"]),o.alert?(d(),R(A,{key:0,class:"alert",prominent:"",type:"error",variant:"flat"},{default:t(()=>[u(C(o.alert),1)]),_:1})):N("",!0)])}const J=E($,[["render",T],["__scopeId","data-v-9f267621"]]);export{J as default};
