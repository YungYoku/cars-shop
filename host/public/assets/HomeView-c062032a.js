import{_ as g,c as E,a as N,o as i,b as o,d as l,w as m,V as w,F as V,e as f,f as y,g as h,h as p,i as d,j as _,k as q,l as P,p as B,m as k,r as b,n as A,q as L,u as R,s as O,t as j,v,x as T,y as U,z as D,A as Q,B as H,C as z,D as K,E as M,G as W,H as F,O as x,I,J as S}from"./main-3e49f720.js";import{b as G,e as J,t as X,v as Y}from"./filtersData-36fe0b62.js";import{C as Z,i as $}from"./CarsAreaCard-bc061c89.js";const ee={name:"filters-area",props:{brands:{type:Array,required:!0},cars:{type:Array,required:!0},propFiltered:{type:Boolean,required:!0}},data(){return{brand:null,model:null,filters:{body:null,engine:null,transmission:null,volume:null},sendOpportunity:!0,carNamesList:[],brandNamesList:[],bodys:G,engines:J,transmissions:X,volumes:Y,filtered:!1}},computed:{isBrandFiltered(){return!!(this.brand&&(this.filtered||this.propFiltered))},brandRouteQuery(){const s=this.$route.query.brandId,e=this.brands;if(s&&e.length){const a=e.find(u=>u.id===s);if(a)return{id:s,name:a.name}}return{id:s,name:null,routeName:this.$route.name}},isFiltersEmpty(){return E(this.filters)&&this.brand===null&&this.model===null},isFiltersEmptyExceptBrand(){return N(this.filters)&&this.brand}},watch:{brandRouteQuery:{immediate:!0,handler(){this.brand=this.brandRouteQuery.name,this.brandRouteQuery.id?this.$emit("loadCars",this.brandRouteQuery.id):this.brandRouteQuery.routeName==="Home"&&this.reset()},deep:!0},filters:{immediate:!1,handler(){this.isFiltersEmpty&&this.search()},deep:!0},brand(){this.loadBrand()},model(){this.loadCar()}},created(){const s=this.$route.query.brandId;s&&(this.filtered=!0,this.$emit("loadCars",s))},methods:{search(){this.sendOpportunity&&(this.startSendTimer(),this.isFiltersEmptyExceptBrand?(this.filtered=!0,this.$emit("filterBrands",this.brand)):this.isFiltersEmpty||(this.filtered=!0,this.$emit("filterCars",this.filters)))},updateCarNamesList(s){const e=this.cars.filter(a=>a.model.startsWith(s));this.carNamesList=e.map(a=>a.model)},updateBrandNamesList(s){const e=this.brands.filter(a=>a.name.startsWith(s));this.brandNamesList=e.map(a=>a.name)},loadCar(){const s=this.cars.find(e=>e.model===this.model);if(s){const a={brandId:this.$route.query.brandId,modelId:s.id};this.$router.push({path:"/car",query:a})}},loadBrand(){const s=this.brands.find(e=>e.name===this.brand);if(s){const e={brandId:s.id};this.$router.push({path:"/",query:e}),this.$emit("loadCars",s.id)}},startSendTimer(){this.sendOpportunity=!1,setTimeout(()=>{this.sendOpportunity=!0},500)},resetFilter(s){this.filters[s]=null,this.search()},resetFilters(){this.filtered=!1,this.brand=null,this.model=null,Object.keys(this.filters).forEach(e=>{this.filters[e]=null})},async reset(){this.resetFilters(),await this.$router.push("/"),this.$emit("reset")}}},se=s=>(B("data-v-8ff00e43"),s=s(),k(),s),te={class:"filters"},re=se(()=>f("h4",null,"Фильтры",-1)),ae={class:"filter"},ne={class:"filter"},ie={class:"filter"},le={class:"filter"};function de(s,e,a,u,t,r){return i(),o("aside",te,[re,l(P,{onSubmit:q(r.search,["prevent"])},{default:m(()=>[l(w,{modelValue:t.brand,"onUpdate:modelValue":e[0]||(e[0]=n=>t.brand=n),clearable:!0,disabled:r.isBrandFiltered,items:t.brandNamesList,label:"Бренд",onKeyup:e[1]||(e[1]=n=>r.updateBrandNamesList(n.target.value)),"onClick:clear":r.updateBrandNamesList},null,8,["modelValue","disabled","items","onClick:clear"]),r.isBrandFiltered?(i(),o(V,{key:0},[l(w,{modelValue:t.model,"onUpdate:modelValue":e[2]||(e[2]=n=>t.model=n),clearable:!0,items:t.carNamesList,label:"Модель",onKeyup:e[3]||(e[3]=n=>r.updateCarNamesList(n.target.value)),"onClick:clear":r.updateCarNamesList},null,8,["modelValue","items","onClick:clear"]),f("div",ae,[l(y,{modelValue:t.filters.volume,"onUpdate:modelValue":e[4]||(e[4]=n=>t.filters.volume=n),items:t.volumes,label:"Объем двигателя","persistent-hint":"","return-object":""},null,8,["modelValue","items"]),t.filters.volume?(i(),h(p,{key:0,icon:"mdi-delete",text:"",onClick:e[5]||(e[5]=n=>r.resetFilter("volume"))})):d("",!0)]),f("div",ne,[l(y,{modelValue:t.filters.transmission,"onUpdate:modelValue":e[6]||(e[6]=n=>t.filters.transmission=n),items:t.transmissions,label:"Трансмиссия","persistent-hint":"","return-object":""},null,8,["modelValue","items"]),t.filters.transmission?(i(),h(p,{key:0,icon:"mdi-delete",text:"",onClick:e[7]||(e[7]=n=>r.resetFilter("transmission"))})):d("",!0)]),f("div",ie,[l(y,{modelValue:t.filters.engine,"onUpdate:modelValue":e[8]||(e[8]=n=>t.filters.engine=n),items:t.engines,label:"Двигатель","persistent-hint":"","return-object":""},null,8,["modelValue","items"]),t.filters.engine?(i(),h(p,{key:0,icon:"mdi-delete",text:"",onClick:e[9]||(e[9]=n=>r.resetFilter("engine"))})):d("",!0)]),f("div",le,[l(y,{modelValue:t.filters.body,"onUpdate:modelValue":e[10]||(e[10]=n=>t.filters.body=n),items:t.bodys,label:"Корпус","persistent-hint":"","return-object":""},null,8,["modelValue","items"]),t.filters.body?(i(),h(p,{key:0,icon:"mdi-delete",text:"",onClick:e[11]||(e[11]=n=>r.resetFilter("body"))})):d("",!0)])],64)):d("",!0),l(p,{disabled:r.isFiltersEmpty,elevation:"1",type:"action"},{default:m(()=>[_(" Искать ")]),_:1},8,["disabled"]),r.isFiltersEmpty?d("",!0):(i(),h(p,{key:1,class:"mr-4",elevation:"2",onClick:r.reset},{default:m(()=>[_(" Сбросить ")]),_:1},8,["onClick"]))]),_:1},8,["onSubmit"])])}const oe=g(ee,[["render",de],["__scopeId","data-v-8ff00e43"]]);const ue={name:"cars-area",components:{CarsAreaCard:Z},props:{cars:{type:Array,required:!0},carPages:{type:Number,required:!0}},data(){return{model:0,page:1}},computed:{pages(){const s=[];let e=[];return this.cars.forEach(a=>{e.length<9?e.push(a):(s.push(e),e=[])}),this.cars.length<9&&!s.length&&e.length&&(s.push(e),e=[]),s},pagesAmount(){return this.carPages>=0?this.carPages-1:this.pages.length}},watch:{page(){this.carPages>=0&&this.$emit("setPage",this.page)}}},ce=s=>(B("data-v-4d75f409"),s=s(),k(),s),me={class:"cars"},he=ce(()=>f("h4",null,"Машины",-1)),pe={key:0},fe={key:1,class:"wrap"};function _e(s,e,a,u,t,r){const n=b("cars-area-card");return i(),o("div",me,[he,r.pages.length?d("",!0):(i(),o("span",pe,"Пусто")),r.pages.length?(i(),o("div",fe,[(i(!0),o(V,null,A(r.pages[a.carPages>=0?0:t.page-1],(c,C)=>(i(),h(n,{key:c.id+C,car:c},null,8,["car"]))),128))])):d("",!0),r.pagesAmount>1?(i(),h(L,{key:2,modelValue:t.page,"onUpdate:modelValue":e[0]||(e[0]=c=>t.page=c),length:r.pagesAmount,"total-visible":5,circle:""},null,8,["modelValue","length"])):d("",!0)])}const be=g(ue,[["render",_e],["__scopeId","data-v-4d75f409"]]);const ge={name:"brand-card",setup:()=>({loadingStore:R()}),props:{brand:{type:Object,required:!0}},data:()=>({show:!1,image:$}),computed:{description(){return this.brand.description!=="-"?this.brand.description:"Описание отсутствует"}},methods:{async open(){this.loadingStore.start();const s={brandId:this.$props.brand.id};this.$emit("loadCars",this.$props.brand.id),await this.$router.push({path:"/",query:s}),this.loadingStore.end()},swapDescription(){this.show=!this.show}}},ye={class:"brand"};function Ce(s,e,a,u,t,r){return i(),o("div",ye,[l(W,{style:{paddingTop:"40px"},class:"mx-auto","min-width":"240px",width:"100%"},{default:m(()=>[l(O,{"lazy-src":s.image,src:a.brand.image,style:{marginBottom:"20px"},contain:"",height:"64px"},null,8,["lazy-src","src"]),l(j,null,{default:m(()=>[_(v(a.brand.name),1)]),_:1}),l(T,null,{default:m(()=>[l(p,{class:"open",color:"orange lighten-2",text:"",onClick:r.open},{default:m(()=>[_(" МОДЕЛИ ")]),_:1},8,["onClick"]),l(U),l(p,{icon:"",onClick:r.swapDescription},{default:m(()=>[l(D,null,{default:m(()=>[_(v(s.show?"mdi-chevron-up":"mdi-chevron-down"),1)]),_:1})]),_:1},8,["onClick"])]),_:1}),l(Q,null,{default:m(()=>[H(f("div",null,[l(z),l(K,null,{default:m(()=>[_(v(r.description),1)]),_:1})],512),[[M,s.show]])]),_:1})]),_:1})])}const ve=g(ge,[["render",Ce],["__scopeId","data-v-82bfbb89"]]);const Ve={name:"brands-area",components:{BrandsAreaCard:ve},props:{brands:{type:Array,required:!0}},data(){return{model:0,page:1}},computed:{pages(){const s=[];let e=[],a=this.brands;return a.forEach(u=>{e.length<9?e.push(u):(s.push(e),e=[])}),a.length<9&&!s.length&&e.length&&(s.push(e),e=[]),s}},methods:{loadCars(s){this.$emit("loadCars",s)}}},Be=s=>(B("data-v-8ae28ab1"),s=s(),k(),s),ke={class:"brands"},we=Be(()=>f("h4",null,"Бренды",-1)),Fe={key:0},xe={key:1,class:"wrap"};function Ie(s,e,a,u,t,r){const n=b("brands-area-card");return i(),o("div",ke,[we,r.pages.length?d("",!0):(i(),o("span",Fe,"Пусто")),r.pages.length?(i(),o("div",xe,[(i(!0),o(V,null,A(r.pages[t.page-1],c=>(i(),h(n,{key:c.id,brand:c,onLoadCars:r.loadCars},null,8,["brand","onLoadCars"]))),128))])):d("",!0),r.pages.length>1?(i(),h(L,{key:2,modelValue:t.page,"onUpdate:modelValue":e[0]||(e[0]=c=>t.page=c),length:r.pages.length,"total-visible":5,circle:""},null,8,["modelValue","length"])):d("",!0)])}const Se=g(Ve,[["render",Ie],["__scopeId","data-v-8ae28ab1"]]);const Ae={name:"home-view",components:{FiltersArea:oe,CarsArea:be,BrandsArea:Se},data(){return{brands:[],filteredBrands:[],cars:[],filteredCars:[],carPage:-1,filtered:!1}},computed:{brandsShowing(){return this.filteredCars?!this.filtered:!0}},mounted(){this.loadBrands()},methods:{setBrands(s){this.filteredBrands=s},setCars(s){this.filteredCars=s},reset(){this.cars=this.filteredCars=[],this.filteredBrands=this.brands,this.filtered=!1},setCarPage(s){this.carPage=s},async loadBrands(){const s=F(S,"cars","brands"),e=await x(s);if(e.exists()){const a=e.data().brands;this.brands=a,this.setBrands(a),await I("loadBrands")}},filterBrands(s=""){this.setBrands(this.brands.filter(e=>e.name.startsWith(s))),this.setCars(this.cars)},async loadCars(s){const e=F(S,"cars","models"),a=await x(e);if(a.exists()){const t=a.data()[s];this.cars=t,this.setCars(t),this.setCarPage(-1),this.filtered=!0,await I("loadCars")}},filterCars(s){const e=Object.keys(s),a=this.cars.filter(u=>{let t=!0;return e.forEach(r=>{s[r]!==null&&r!=="brand"&&u[r]!==s[r]&&(t=!1)}),t});this.setCars(a)}}},Le={class:"home"};function Ee(s,e,a,u,t,r){const n=b("filters-area"),c=b("brands-area"),C=b("cars-area");return i(),o("div",Le,[l(n,{brands:t.brands,cars:t.filteredCars,propFiltered:t.filtered,onFilterBrands:r.filterBrands,onFilterCars:r.filterCars,onLoadCars:r.loadCars,onReset:r.reset},null,8,["brands","cars","propFiltered","onFilterBrands","onFilterCars","onLoadCars","onReset"]),r.brandsShowing?(i(),h(c,{key:"brand",brands:t.filteredBrands,onLoadCars:r.loadCars},null,8,["brands","onLoadCars"])):(i(),h(C,{key:"cars","car-pages":t.carPage,cars:t.filteredCars,onSetPage:r.setCarPage},null,8,["car-pages","cars","onSetPage"]))])}const Re=g(Ae,[["render",Ee],["__scopeId","data-v-2836f25d"]]);export{Re as default};
